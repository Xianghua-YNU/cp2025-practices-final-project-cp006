# 2_code/ -源代码目录

**目的:** 存放所有用于模拟、分析和可视化的代码。代码的质量是评分的重要组成部分。

**内容:**
README.md`（代码说明书）
# 芯片热传导数值模拟项目

## 项目结构
- `main_simulation.py`: 主程序，控制模拟流程
- `numerical_methods.py`: 数值求解算法（Jacobi和SOR迭代法）
- `visualization.py`: 可视化绘图函数
- `data_analysis.py`: 数据分析工具
- `utils.py`: 辅助工具函数
- `requirements.txt`: 项目依赖

## 环境配置
1. 安装Python 3.7+
2. 安装依赖库：
```bash
pip install -r requirements.txt
```

## 运行过程
运行过程说明
参数输出：
程序开始后会显示模拟参数（网格尺寸、芯片边长、收敛容差等）。
求解过程：
先运行 Jacobi 迭代法，显示迭代次数和耗时；
再运行 SOR 迭代法，同样显示迭代次数和耗时；
最后输出两种方法的性能对比（加速比）。
可视化窗口：
自动弹出两个图形窗口，分别展示 Jacobi 和 SOR 方法的温度分布：
左侧为 3D 温度曲面图（含温度棒）；
右侧为 2D 等值线与热流场图（含温度棒）。

## 功能说明
1. **主程序**：设置模拟参数，调用数值方法求解热传导方程，分析结果并可视化
2. **数值方法**：实现了Jacobi和SOR迭代法求解非齐次边界条件下的热传导方程
3. **可视化**：生成3D温度分布图和2D温度等值线+热流场图
4. **数据分析**：计算误差和收敛率等指标
5. **辅助工具**：提供计时装饰器等实用功能


### 模块化优势
1. **代码复用**：`numerical_methods.py`中的求解器可用于其他热传导问题
2. **可维护性**：功能分离，便于修改和扩展
3. **协作开发**：不同模块可由不同人员并行开发
4. **测试方便**：各模块可独立测试


# 输运方程隐式格式求解、边界条件处理及稳定性验证

运行过程
运行过程说明
程序运行后将依次执行热传导方程的数值求解与可视化分析，具体流程如下：

参数初始化：设置空间长度 L=1.0m、离散点数 Nx=50、时间步长 dt=0.01s 等物理参数，初始浓度分布采用高斯函数 u0 = exp (-((x - L/2)²)/(2×0.1²))。
系数矩阵构建：根据扩散系数 D=0.01m²/s 和对流速度 v=0.1m/s，生成三对角系数矩阵，其中主对角线元素为 1+2α（α=D・dt/dx²），上下对角线分别包含对流项系数 ±β（β=v・dt/(2dx)）。
时间迭代求解：通过 Crank-Nicolson 方法迭代计算 Nt=100 个时间步，每步处理 Dirichlet 边界条件（左边界 u=1，右边界 u=0），并存储各时刻浓度分布。
参数输出
程序启动时显示核心模拟参数：

空间参数：长度 L=1.0m，离散点数 Nx=50，步长 dx=0.02m
时间参数：步长 dt=0.01s，总时间 T=1.0s，步数 Nt=100
物理参数：扩散系数 D=0.01m²/s，对流速度 v=0.1m/s
求解过程
浓度演化计算：通过三对角矩阵求解器solve_banded迭代计算各时间步的浓度分布，存储为u_history数组（形状为 (101, 50)）。
边界条件处理：支持非齐次 Dirichlet 边界（如左边界随时间线性增长 u=t），并在每步迭代中更新边界值。
可视化窗口
程序自动生成 4 个图形窗口，分别展示：

浓度演化图：左侧为不同时刻（t=0, 0.1, ..., 1.0s）的浓度分布曲线，右侧标注对应时间点的高斯衰减特征。
误差分析图：纯扩散场景下（v=0），数值解与解析解的均方误差（MSE）随时间变化曲线（对数坐标）。
CFL 条件验证图：不同时间步长（dt=0.1, 0.01, 0.001s）下的稳态浓度分布，验证稳定性条件。
非齐次边界影响图：左边界线性增长（u=t）时，浓度分布随时间的演化过程，展示边界条件对扩散的调控作用。


功能说明
1. 主程序
参数管理：集中设置空间、时间及物理参数，支持动态调整（如修改 D、v 或边界条件）。
流程控制：协调矩阵构建、迭代求解及多场景可视化，实现从建模到结果分析的全流程自动化。
2. 数值方法
Crank-Nicolson 格式：采用二阶精度的隐式有限差分法，通过三对角矩阵求解器高效处理扩散 - 对流方程。
边界条件处理：支持 Dirichlet 边界条件（包括齐次与非齐次场景），通过更新右端向量b实现边界值嵌入。
3. 可视化
浓度演化分析：plot_concentration_evolution函数绘制不同时刻的浓度曲线，直观展示高斯分布的扩散与对流过程。
误差量化：plot_error_analysis通过纯扩散解析解对比，计算 MSE 并绘制误差曲线，验证数值方法精度。
稳定性验证：plot_cfl_verification测试不同 dt 下的稳态解，验证 CFL 条件（如 dt=0.1s 时解发散，dt=0.001s 时收敛）。
边界效应分析：plot_nonhomogeneous_boundary演示非齐次边界（u=t）对浓度分布的影响，体现边界驱动的扩散特性。
4. 数据分析
误差评估：通过解析解对比计算 MSE，量化数值方法的时间 - 空间精度。
稳定性分析：基于不同 dt 的结果，验证数值方法的稳定性条件（如要求 α≤0.5）。
5. 辅助工具
字体优化：get_available_chinese_font函数自动检测系统中文字体（如 SimHei、Microsoft YaHei），确保可视化标签正确显示。
矩阵构建：build_coefficients函数封装三对角矩阵生成逻辑，支持扩散 - 对流项的耦合计算。


#差分法求解波动方程
运行过程
1. 库导入与字体配置
 
numpy ：数值计算（数组操作、数学函数）。
matplotlib ：绘图与动画生成。
FuncAnimation ：创建动态动画。
字体配置：解决中文显示问题（ SimHei ）和负号乱码。
 
2. 参数设置与稳定性条件
 
物理参数：
wave_speed=1.0 ：波速。
space_length=1.0 ：空间域长度（0到1米）。
total_time=2.0 ：总模拟时间（秒）。
离散化参数：
grid_points=100 ：空间网格点数（空间步长 dx=0.01 ）。
time_steps=400 ：时间步数（时间步长 dt=0.005 ）。
稳定性条件：
计算稳定性子 stability_factor=wave_speed*dt/dx ，要求其≤1（否则数值解发散）。
 
3. 初始条件
 
初始位移：高斯脉冲  initial_displacement = exp(-((x-0.5)/0.15)²) ，中心在 x=0.5 ，宽度由 0.15 控制。
初始速度： initial_velocity=0 （初始时刻静止）。
 
4. 前两层解计算
 
第一层（ u_prev_prev ）：直接使用初始位移。
第二层（ u_prev ）：通过显式差分格式计算，基于初始位移和稳定性因子，引入空间二阶导数（通过 np.roll 实现左右邻点偏移），边界条件设为0（固定端点）。
 
5. 时间层迭代（波动方程求解）
 
波动方程差分格式：
$$ u^{n+1}i = 2u^n_i - u^{n-1}i + \nu^2 (u^n{i+1} 2u^n_i + u^n{i-1}) $$
其中 ν=stability_factor ，通过递推计算每个时间层的位移。
边界条件：两端点（ i=0 和 i=-1 ）位移始终为0。
 
6. 动画生成与保存
 
绘图配置：
横轴为位置 X ，纵轴为位移 Y ，范围 [-1.1, 1.1] 。
网格线增强可读性。
 动画更新函数： animate(frame) 逐帧更新波形数据（ u[frame] ）。
保存动画：
优先使用 ffmpeg 生成GIF，失败则改用 Pillow ，帧率20fps，间隔50ms。
 
关键原理
 
有限差分法：将连续空间和时间离散化，通过邻点差分近似导数。
显式格式：依赖前两层结果计算当前层，需满足稳定性条件避免数值振荡。
波动传播：高斯脉冲以设定波速向两端传播，遇边界反射（因固定端条件产生反向波形）。

功能说明
1. 主程序
 
参数管理：集中设置空间长度（ space_length ）、总时间（ total_time ）、网格点数（ grid_points ）、时间步数（ time_steps ）、波速（ wave_speed ）等参数，通过稳定性因子（ stability_factor ）验证数值解稳定性（需≤1）。
流程控制：按“初始条件定义→前两层解计算→全时间层迭代→动画生成”流程自动化执行，协调数值计算与可视化模块。
 
2. 数值方法
 
有限差分格式：采用显式中心差分法求解一维波动方程，时间二阶精度，空间二阶精度。
前两层解通过初始位移和半步长差分计算，后续层通过递推公式  u^{n+1} = 2u^n - u^{n-1} + ν²∇²u^n （ ν=stability_factor ）更新。
边界条件：固定端（Dirichlet）边界条件，强制两端点（ x=0 和 x=1 ）位移为0，通过手动赋值 u_current[[0, -1]] = 0 实现。
 
3. 可视化
 
动态波形演化：通过 FuncAnimation 生成GIF动画，逐帧展示位移随时间的传播过程（高斯脉冲向两端扩散、反射）。
静态绘图配置：包含坐标轴标签（位置X、位移Y）、标题、网格线，支持中文显示（通过 SimHei 字体配置）。
 
4. 数据分析
 
稳定性验证：通过判断 stability_factor 是否超过1触发报错，验证显式格式的CFL稳定性条件（需满足 ν≤1 ）。
波形特征分析：直观展示波动传播的对称性、边界反射特性（固定端反射导致波形反向）。
 
5. 辅助工具
 
字体优化：通过 plt.rcParams 配置中文字体 SimHei ，解决中文标签乱码问题。
数组操作封装：利用 np.roll 实现邻点偏移，计算空间二阶导数（ ∇²u ≈ (u_{i+1}-2u_i+u_{i-1})/dx² ），简化差分格式实现。
 
功能总结
 
核心场景：模拟一维固定端弦的自由振动（初始高斯脉冲扰动），通过显式有限差分法求解波动方程，动态可视化波形传播与反射过程。
关键能力：参数化建模、稳定性校验、边界条件处理、动态结果可视化，适用于教学演示或波动现象的基础数值模拟。
